<!DOCTYPE html>
<html lang="pt-BR">

<head>
  <meta charset="UTF-8" />
  <title>Pontuação</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    :root {
      --offset: 482px;
      --gap: 32px;
      --duration: 600ms;
    }

    button,
    input,
    select,
    textarea,
    a {
      outline: none;
    }

    body {
      font-family: Arial, sans-serif;
      background: #f2f2f2;
      color: #000;
      margin: 0;
      padding: 20px;
      min-height: 100vh;
      overflow-x: hidden;
      overflow-y: auto;
      transition: background 0.3s, color 0.3s;
      -webkit-overflow-scrolling: touch;
    }

    /* DARK MODE EXTRA STYLES - BEGIN */

    body.dark-mode {
      background: #121212;
      color: #f2f2f2;
    }

    body.dark-mode .container {
      background: #1e1e1e;
      color: #f2f2f2;
      box-shadow: 0 4px 8px rgba(255, 255, 255, 0.05);
    }

    body.dark-mode th {
      background-color: #333;
    }

    body.dark-mode .option-btn {
      background: #1e1e1e;
      border-color: #4a90e2;
      color: #4a90e2;
    }

    body.dark-mode .option-btn.active {
      background: #4a90e2;
      color: #fff;
    }

    body.dark-mode .option-btn:hover {
      background: #0056b3;
      color: #fff;
    }

    body.dark-mode button {
      background: #4a90e2;
      color: #fff;
    }

    body.dark-mode button:hover {
      background: #0056b3;
    }

    body.dark-mode .copy-btn {
      background: #28a745;
      color: #fff;
    }

    body.dark-mode .copy-btn:hover {
      background: #1e7e34;
    }

    body.dark-mode table {
      background: #1e1e1e;
      border-color: #333;
      color: #f2f2f2;
    }

    body.dark-mode th {
      background-color: #333;
      color: #fff;
    }

    body.dark-mode td {
      background-color: #1e1e1e;
      border-color: #333;
      color: #ccc;
    }

    body.dark-mode .time-item {
      background: #1e1e1e;
      border: 1px solid #4a90e2;
      color: #4a90e2;
    }

    body.dark-mode .flash-blue {
      background: #4a90e2 !important;
      color: #fff !important;
    }

    body.dark-mode .shortcuts-content {
      background: #1e1e1e;
      color: #f2f2f2;
    }

    body.dark-mode .shortcuts-content h2 {
      color: #4a90e2;
    }

    body.dark-mode .shortcuts-content li {
      color: #ccc;
    }

    body.dark-mode .shortcuts-content kbd {
      background: #333;
      border: 1px solid #555;
      color: #eee;
    }

    body.dark-mode .toast {
      background: #333;
      color: #f2f2f2;
    }

    /* DARK MODE EXTRA STYLES - END */

    #themeToggle {
      position: fixed;
      top: 15px;
      left: 15px;
      width: 40px;
      height: 40px;
      border-radius: 50%;
      border: none;
      background: #007bff;
      color: #fff;
      font-size: 18px;
      cursor: pointer;
      z-index: 10000;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: background 0.3s;
    }

    #themeToggle:hover {
      background: #0056b3;
    }

    .stage {
      position: relative;
      width: 100%;
      max-width: 1200px;
      margin: 0 auto;
      min-height: 520px;
      box-sizing: border-box;
      height: 100%;
    }

    .main {
      display: flex;
      gap: var(--gap);
      justify-content: center;
      flex-wrap: wrap;
    }

    .container {
      background: #fff;
      padding: 20px 30px;
      border-radius: 10px;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
      width: 450px;
      box-sizing: border-box;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;

      position: absolute;
      left: 50%;
      top: 20px;
      transform: translateX(-50%);
      transition: transform var(--duration) cubic-bezier(0.22, 1, 0.36, 1),
        opacity var(--duration) ease, visibility var(--duration) ease;
      will-change: transform, opacity;
    }

    #calculatorContainer {
      z-index: 3;
    }

    #tableContainer {
      z-index: 2;
    }

    .visually-hidden {
      opacity: 0;
      visibility: hidden;
      pointer-events: none;
    }

    .stage.table-visible #calculatorContainer {
      transform: translateX(calc(-100% - var(--gap) / 2));
    }

    .stage.table-visible #tableContainer {
      transform: translateX(calc(0% + var(--gap) / 2));
      opacity: 1;
      visibility: visible;
      pointer-events: auto;
    }

    .stage.meeting #calculatorContainer,
    .stage.meeting #tableContainer {
      transform: translateX(-50%);
    }

    .stage.meeting #calculatorContainer {
      opacity: 1;
      visibility: visible;
      pointer-events: auto;
    }

    .stage.meeting #tableContainer {
      opacity: 0;
      pointer-events: none;
    }

    fieldset {
      margin-bottom: 15px;
      border: none;
    }

    legend {
      font-weight: bold;
      margin-bottom: 5px;
    }

    .button-group-options {
      display: flex;
      gap: 15px;
      margin-top: 5px;
    }

    .option-btn {
      padding: 8px 15px;
      border: 1px solid #007bff;
      border-radius: 5px;
      background: #fff;
      color: #007bff;
      cursor: pointer;
      transition: 0.3s;
    }

    .option-btn.active {
      background: #007bff;
      color: #fff;
      text-decoration: underline;
    }

    .option-btn:hover {
      background: #0056b3;
      color: #fff;
    }

    .result-container {
      margin-top: 20px;
      font-size: 24px;
      font-weight: bold;
      text-align: center;
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 10px;
      transition: opacity 0.5s ease;
    }

    .copy-btn {
      padding: 5px 10px;
      font-size: 14px;
      background: #28a745;
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      display: none;
      /* escondido por padrão */
    }

    .copy-btn:hover {
      background: #1e7e34;
    }

    .button-group {
      display: flex;
      justify-content: center;
      gap: 10px;
      margin-top: 15px;
    }

    button {
      padding: 10px 20px;
      font-size: 16px;
      background: #007bff;
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
    }

    button:hover {
      background: #0056b3;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      cursor: default;
    }

    #easterEgg {
      cursor: pointer;
    }

    .no-select {
      -webkit-touch-callout: none;
      -webkit-user-select: none;
      -khtml-user-select: none;
      -moz-user-select: none;
      -ms-user-select: none;
      user-select: none;
    }

    th {
      font-size: 14px;
    }

    td {
      font-size: 12px;
    }

    th,
    td {
      border: 1px solid #ddd;
      text-align: center;
    }

    th {
      background-color: #007bff;
      color: white;
      padding: 3px;
    }

    .table-container {
      max-height: 600px;
      overflow-y: auto;
    }

    .toast {
      position: fixed;
      top: 20px;
      right: 20px;
      background: #000;
      color: #ccc;
      padding: 12px 20px;
      border-radius: 5px;
      font-family: Arial, sans-serif;
      font-size: 14px;
      opacity: 1;
      transition: opacity 1s ease;
      z-index: 9999;
      pointer-events: none;
      width: 200px;
      word-wrap: break-word;
      white-space: normal;
      text-align: left;
    }

    .toast.fade-out {
      opacity: 0;
    }

    .time-row {
      display: flex;
      margin-top: 20px;
      width: 100%;
      gap: 10px;
    }

    .time-item {
      flex: 1;
      border: 1px solid #007bff;
      color: #007bff;
      border-radius: 8px;
      padding: 10px;
      background: #fff;
      text-align: center;
      cursor: default;
      transition: background 2s, color 2s;
    }

    .time-item h4 {
      margin: 0 0 5px 0;
      font-size: 16px;
      text-decoration: underline;
    }

    .time-item p {
      margin: 0;
      font-size: 18px;
      font-weight: bold;
    }

    .flash-blue {
      background: #007bff !important;
      color: white !important;
      transition: none;
    }

    .shortcuts-modal {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.7);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 10;
      opacity: 0;
      visibility: hidden;
      transition: opacity 0.3s ease, visibility 0s 0.3s;
    }

    .shortcuts-modal.visible {
      opacity: 1;
      visibility: visible;
      transition: opacity 0.3s ease;
    }

    .shortcuts-content {
      background: #fff;
      padding: 30px;
      border-radius: 10px;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
      text-align: left;
      max-width: 400px;
      width: 90%;
    }

    .shortcuts-content h2 {
      text-align: center;
      margin-top: 0;
      font-size: 24px;
      color: #007bff;
    }

    .shortcuts-content ul {
      list-style: none;
      padding: 0;
      margin: 20px 0 0;
    }

    .shortcuts-content li {
      margin-bottom: 15px;
      font-size: 16px;
      color: #333;
    }

    .shortcuts-content kbd {
      display: inline-block;
      padding: 3px 6px;
      font-family: monospace;
      font-size: 14px;
      background-color: #eee;
      border: 1px solid #ccc;
      border-radius: 3px;
      box-shadow: 0 1px 0 rgba(0, 0, 0, 0.2), 0 0 0 2px #fff inset;
    }

    @media (max-width: 980px) {
      :root {
        --offset: 412px;
      }
    }

    @media (max-width: 640px) {
      :root {
        --offset: 352px;
      }
    }

    @media (max-width: 768px) {
      .stage {
        display: flex;
        flex-direction: column;
        align-items: center;
        min-height: auto;
        height: auto;
      }

      .container {
        position: static;
        transform: none;
        width: 100%;
        max-width: 450px;
        margin-bottom: 20px;
      }

      .stage.table-visible #calculatorContainer,
      .stage.table-visible #tableContainer,
      .stage.meeting #calculatorContainer,
      .stage.meeting #tableContainer {
        transform: none;
        opacity: 1;
        visibility: visible;
        pointer-events: auto;
      }
    }
  </style>
</head>

<body>
  <button id="themeToggle">🌙</button>
  <div class="stage" id="stage">
    <div class="main" aria-hidden="true"></div>
    <div class="container" id="calculatorContainer">
      <fieldset>
        <legend>Incerteza</legend>
        <div class="button-group-options" data-group="uncertainty">
          <button class="option-btn" data-value="Small">Small</button>
          <button class="option-btn" data-value="Medium">Medium</button>
          <button class="option-btn" data-value="Large">Large</button>
        </div>
      </fieldset>
      <fieldset>
        <legend>Complexidade</legend>
        <div class="button-group-options" data-group="complexity">
          <button class="option-btn" data-value="Small">Small</button>
          <button class="option-btn" data-value="Medium">Medium</button>
          <button class="option-btn" data-value="Large">Large</button>
        </div>
      </fieldset>
      <fieldset>
        <legend>Esforço</legend>
        <div class="button-group-options" data-group="effort">
          <button class="option-btn" data-value="Small">Small</button>
          <button class="option-btn" data-value="Medium">Medium</button>
          <button class="option-btn" data-value="Large">Large</button>
        </div>
      </fieldset>
      <div class="result-container" id="resultContainer">
        <div class="result" id="result">-</div>
        <button class="copy-btn" id="copyBtn">Copiar</button>
      </div>
      <div class="button-group">
        <button id="clearBtn" onclick="clearFields()">Limpar valores</button>
        <button id="toggleTableBtn" onclick="toggleTable()">
          Mostrar tabela
        </button>
        <button onclick="resetTime()">Reiniciar tempo</button>
      </div>
      <div class="time-row">
        <div class="time-item">
          <h4>Horário de abertura</h4>
          <p id="openTime">--:--:--</p>
        </div>
        <div class="time-item">
          <h4>Tempo decorrido</h4>
          <p id="elapsedTime">00:00:00</p>
        </div>
      </div>
    </div>
    <div class="container visually-hidden" id="tableContainer">
      <div class="table-container">
        <table id="pointsTable">
          <thead>
            <tr>
              <th>Incerteza</th>
              <th>Complexidade</th>
              <th>Esforço</th>
              <th id="easterEgg">Pontos</th>
              <!-- Você inspecionou o HTML e encontrou o Easter Egg, parabéns! -->
              <!-- CTRL ALT SHIFT T -->
            </tr>
          </thead>
          <tbody></tbody>
        </table>
        <audio id="gta-sound" src="gta.mp3"></audio>
      </div>
    </div>
  </div>
  <div class="shortcuts-modal visually-hidden" id="shortcutsModal" aria-modal="true" role="dialog"
    aria-labelledby="shortcutsTitle">
    <div class="shortcuts-content">
      <h2 id="shortcutsTitle">Atalhos de Teclado</h2>
      <ul>
        <li><kbd>Escape | Enter</kbd> Ocultar/Exibir a Tabela de Pontos</li>
        <li><kbd>Ctrl C</kbd> Copiar valor calculado</li>
        <li><kbd>Numpad 7 | 8 | 9</kbd> Selecionar Incerteza</li>
        <li><kbd>Numpad 4 | 5 | 6</kbd> Selecionar Complexidade</li>
        <li><kbd>Numpad 1 | 2 | 3</kbd> Selecionar Esforço</li>
        <li><kbd>Numpad 0</kbd> Limpar valores</li>
        <li><kbd>Barra de Espaço</kbd> Mostrar este painel de atalhos</li>
      </ul>
    </div>
  </div>
  <script>
    // ---- DARK MODE ----
    const themeToggle = document.getElementById("themeToggle");
    const userPref = localStorage.getItem("theme");

    if (userPref === "dark" || !userPref) {
      document.body.classList.add("dark-mode");
      themeToggle.textContent = "☀️";
    } else {
      document.body.classList.remove("dark-mode");
      themeToggle.textContent = "🌙";
    }

    themeToggle.addEventListener("click", () => {
      document.body.classList.toggle("dark-mode");
      const isDark = document.body.classList.contains("dark-mode");
      themeToggle.textContent = isDark ? "☀️" : "🌙";
      localStorage.setItem("theme", isDark ? "dark" : "light");
    });
  </script>
  <script>
    const pointsTable = {
      "Small-Small-Small": 1,
      "Small-Small-Medium": 2,
      "Small-Small-Large": 5,
      "Small-Medium-Small": 2,
      "Small-Medium-Medium": 3,
      "Small-Medium-Large": 5,
      "Small-Large-Small": 3,
      "Small-Large-Medium": 5,
      "Small-Large-Large": 8,
      "Medium-Small-Small": 3,
      "Medium-Small-Medium": 5,
      "Medium-Small-Large": 8,
      "Medium-Medium-Small": 5,
      "Medium-Medium-Medium": 5,
      "Medium-Medium-Large": 8,
      "Medium-Large-Small": 5,
      "Medium-Large-Medium": 8,
      "Medium-Large-Large": 8,
      "Large-Small-Small": 5,
      "Large-Small-Medium": 8,
      "Large-Small-Large": 13,
      "Large-Medium-Small": 8,
      "Large-Medium-Medium": 8,
      "Large-Medium-Large": 13,
      "Large-Large-Small": 8,
      "Large-Large-Medium": 13,
      "Large-Large-Large": 13,
    };

    const fibonacciMap = { 1: 2, 2: 3, 3: 5, 5: 8, 8: 13, 13: 21 };

    let easterEggMode = false;
    let clickCount = 0;

    const result = document.getElementById("result");
    const copyBtn = document.getElementById("copyBtn");
    const optionGroups = document.querySelectorAll(".button-group-options");
    const resultContainer = document.getElementById("resultContainer");

    const selections = { uncertainty: "", complexity: "", effort: "" };

    optionGroups.forEach((group) => {
      const groupName = group.dataset.group;
      group.querySelectorAll(".option-btn").forEach((btn) => {
        btn.addEventListener("click", () => {
          group
            .querySelectorAll(".option-btn")
            .forEach((b) => b.classList.remove("active"));
          btn.classList.add("active");
          selections[groupName] = btn.dataset.value;
          updateResult();
        });
      });
    });

    function updateResult() {
      const { uncertainty, complexity, effort } = selections;
      if (!uncertainty || !complexity || !effort) {
        result.textContent = "-";
        copyBtn.style.display = "none";
        return;
      }
      const key = `${uncertainty}-${complexity}-${effort}`;
      let value = pointsTable.hasOwnProperty(key)
        ? pointsTable[key]
        : "inexistente";
      if (easterEggMode && fibonacciMap[value]) {
        value = fibonacciMap[value];
      }
      result.textContent = value;
      copyBtn.style.display = "inline-block";
    }

    copyBtn.addEventListener("click", () => {
      navigator.clipboard.writeText(result.textContent).then(() => {
        copyBtn.textContent = "Copiado!";
        setTimeout(() => (copyBtn.textContent = "Copiar"), 1500);
      });
    });

    function clearFields() {
      resultContainer.classList.add("fade");
      setTimeout(() => {
        for (let key in selections) selections[key] = "";
        document
          .querySelectorAll(".option-btn")
          .forEach((btn) => btn.classList.remove("active"));
        result.textContent = "-";
        copyBtn.style.display = "none";
        resultContainer.classList.remove("fade");
      }, 500);
    }

    function renderTable() {
      const tbody = document.querySelector("#pointsTable tbody");
      tbody.innerHTML = "";
      for (const key in pointsTable) {
        const [uncertainty, complexity, effort] = key.split("-");
        const points = pointsTable[key];
        const row = document.createElement("tr");
        row.innerHTML = `
            <td>${uncertainty}</td>
            <td>${complexity}</td>
            <td>${effort}</td>
            <td>${points}</td>
          `;
        tbody.appendChild(row);
      }
    }

    // Easter Egg trapaça de pontos
    const easterEgg = document.getElementById("easterEgg");

    function showToast(message, playSound = false) {
      const toast = document.createElement("div");
      toast.className = "toast";
      toast.innerHTML = message.replace(/\n/g, "<br>");
      document.body.appendChild(toast);
      if (playSound) document.getElementById("gta-sound").play();

      setTimeout(() => {
        toast.classList.add("fade-out");
        toast.addEventListener("transitionend", () => toast.remove());
      }, 5000);
    }

    function toggleEasterEgg() {
      easterEggMode = !easterEggMode;
      showToast(
        easterEggMode
          ? "TRAPAÇA ATIVADA! 🔥\nPontuações mais altas."
          : "TRAPAÇA DESATIVADA! ⚠️\nPontuações normalizadas.",
        true
      );
      updateResult();
    }

    easterEgg.addEventListener("click", () => {
      clickCount++;
      if (clickCount >= 10) {
        clickCount = 0;
        toggleEasterEgg();
      }
    });

    document.addEventListener("keydown", (e) => {
      if (e.ctrlKey && e.altKey && e.shiftKey && e.code === "KeyT") {
        toggleEasterEgg();
      }
    });

    // Dar spoiler do easter egg para o usuário
    // Mas só se ele ficar com o app aberto por 24 horas
    setTimeout(() => {
      showToast("Ctrl + Alt + Shift + T");
    }, 24 * 60 * 60 * 1000);

    showToast("Pressione espaço para ver os atalhos de teclado!");

    renderTable();

    // Cronômetro
    function formatTime(date) {
      let h = String(date.getHours()).padStart(2, "0");
      let m = String(date.getMinutes()).padStart(2, "0");
      let s = String(date.getSeconds()).padStart(2, "0");
      return `${h}:${m}:${s}`;
    }

    const openTimeEl = document.getElementById("openTime");
    const elapsedTimeEl = document.getElementById("elapsedTime");
    const timeItems = document.querySelectorAll(".time-item");

    let startTime = new Date();
    openTimeEl.textContent = formatTime(startTime);

    function updateElapsed() {
      const now = new Date();
      let diffMs = now - startTime;
      let hours = Math.floor(diffMs / 3600000);
      let minutes = Math.floor((diffMs % 3600000) / 60000);
      let seconds = Math.floor((diffMs % 60000) / 1000);
      elapsedTimeEl.textContent =
        String(hours).padStart(2, "0") +
        ":" +
        String(minutes).padStart(2, "0") +
        ":" +
        String(seconds).padStart(2, "0");
    }

    function resetTime() {
      startTime = new Date();
      openTimeEl.textContent = formatTime(startTime);
      updateElapsed();
      timeItems.forEach((el) => {
        el.classList.add("flash-blue");
        void el.offsetWidth;
        setTimeout(() => el.classList.remove("flash-blue"), 10);
      });
    }

    updateElapsed();
    setInterval(updateElapsed, 1000);

    const stage = document.getElementById("stage");
    const calculatorContainer = document.getElementById(
      "calculatorContainer"
    );
    const tableContainer = document.getElementById("tableContainer");
    const toggleBtn = document.getElementById("toggleTableBtn");
    const TRANSITION_DURATION = 600;

    function toggleTable() {
      if (tableContainer.classList.contains("visually-hidden")) {
        tableContainer.classList.remove("visually-hidden");

        void tableContainer.offsetWidth;

        stage.classList.remove("meeting");
        stage.classList.add("table-visible");

        toggleBtn.textContent = "Ocultar tabela";
      } else {
        stage.classList.add("meeting");
        stage.classList.remove("table-visible");
        toggleBtn.textContent = "Mostrar tabela";

        setTimeout(() => {
          tableContainer.classList.add("visually-hidden");
          stage.classList.remove("meeting");
          calculatorContainer.style.opacity = "";
        }, TRANSITION_DURATION + 20);
      }
    }

    document.addEventListener("keydown", (e) => {
      if (e.key === "Escape" || e.key === "Enter") {
        toggleTable();
      }
    });

    document.addEventListener("keydown", (e) => {
      if (e.code.startsWith("Numpad")) {
        const key = e.key;

        if (key === "0") return clearFields();

        const numpadMap = {
          1: { group: "effort", value: "Small" },
          2: { group: "effort", value: "Medium" },
          3: { group: "effort", value: "Large" },
          4: { group: "complexity", value: "Small" },
          5: { group: "complexity", value: "Medium" },
          6: { group: "complexity", value: "Large" },
          7: { group: "uncertainty", value: "Small" },
          8: { group: "uncertainty", value: "Medium" },
          9: { group: "uncertainty", value: "Large" },
        };

        const selection = numpadMap[key];

        if (selection) {
          const groupSelector = `[data-group="${selection.group}"]`;
          const buttonSelector = `[data-value="${selection.value}"]`;
          const button = document.querySelector(
            `${groupSelector} ${buttonSelector}`
          );

          if (button) {
            button.click();
          }
        }
      }
    });

    document.addEventListener("keydown", (e) => {
      if (e.code === "Space") {
        const modal = document.getElementById("shortcutsModal");
        if (modal.classList.contains("visible")) {
          modal.classList.remove("visible");
          setTimeout(() => {
            modal.classList.add("visually-hidden");
          }, 300);
        } else {
          modal.classList.remove("visually-hidden");
          modal.classList.add("visible");
        }
      }
    });

    document.addEventListener("keydown", (e) => {
      if (e.ctrlKey && e.key === "c") {
        const resultValue = result.textContent;
        if (resultValue !== "-" && resultValue !== "inexistente") {
          navigator.clipboard
            .writeText(resultValue)
            .then(() => {
              copyBtn.textContent = "Copiado!";
              setTimeout(() => (copyBtn.textContent = "Copiar"), 1500);
            })
            .catch((err) => {
              console.error("Falha ao copiar o texto: ", err);
            });
        }
      }
    });

    document
      .querySelectorAll("button, input, select, textarea, a")
      .forEach((el) => el.setAttribute("tabindex", "-1"));
  </script>
</body>

</html>